# Бот для рассылки в тг и вк
Данный бот создан для отправки получаемых сообщений в телеграм-канал и в сервис [Рассылки](https://vk.com/app5748831) в вк.

## Принцип работы
Для отправки сообщения во все сервисы необходимо: 
1. Быть в списке админов данного бота (прописано в коде)
2. В начале отправляемого сообщения написать `/post`

Бот поддерживает отправку смайликов и корректно работает с переносам строк.

## Как добавить админа?
Если у вас уже всё настроено, или вы в процессе, пишите боту команду `access`. Когда он вернёт ответ `Ваш id: 666000` - это значит он вас слышит, и вы можете добавить данный id внутрь массива `$arrayOfIds` как обычную строчку. Это список админов, их там может быть как 1, так и несколько (перечислять через запятую). 

Таким образом для добавления нового админа попросите его написать команду access в лс сообщества и скопируйте его id в массив. Готово.

## Примеры
### Не будет отправлено во все сервисы (даже от админов)
`Привет, как дела?`

`/POST Внимание! Важная информация!`

`post-запрос - это одни из методов запроса, поддерживаемый HTTP-протоколом.`

`Для отправки сообщения напишите /post в ответ на это сообщение`

### Будет отправлено во все сервисы (если вы являетесь админом)
`/post Всем срочно быть во вторник на собрании!`

`/postТебе скучно, одиноко и хочется чего-то такого светлого и хорошего? Вступай в наш клуб любителей пива!`

## Как настроить? (для разработчиков)
Вам нужны 2 файла из этого репозитория - index.php и vk_api.php. Работаем только с index-ом, vk_api сразу идеален \**зачёркнуто*\* предоставлен разработчиками вк.

Итак, в самом верху index.php видим список констант, которые надо заполнить своими данными. Разбираемся.

- **VK_KEY**: открываем нашу группу, В КОТОРУЮ будут писать админы для старта рассылки и переходим в Управление -> Работа с API -> Ключи доступа. Нажимаем кнопку "Создать ключ", ставим галочку рядом с пунктом про чтение сообщений сообщества (остальное не надо) и копируем созданный ключ. Он будет очень длинный и выглядеть примерно так: `vk1.a.<много цифр и букв>`
- **ACCESS_KEY**: там же, где и делали прошлый пункт, но во вкладке Callback API. В настройках сервера находим надпись `Строка, которую должен вернуть сервер: <8 символов>`. Эти 8 символов нам и нужны.
- **VERSION**: у нас в коде стоит 5.81. Точно такую же надо поставить в настройках сервера в пункте Версия API. Также в поле Адрес в вк нужно ввести конечный адрес нахождения вашего скрипта index.php. То есть там будет что-то вроде `https://yourdomain.com/path/to/bot/index.php`.

После внесения этих трёх настроек в вк **необходимо** нажать кнопку "Подтвердить" во вкладке настройки сервера. Если у вас появилась зелёная галочка рядом с адресом, то всё супер, этот этап завершён.

- **RASSILKA_KEY**: да, я не вспомнил, как будет рассылка по-английски. Сори. Этот ключ нужно взять после установки сервиса [Рассылки](https://vk.com/app5748831) в вашу группу вк, в которой вы хотите собирать пользователей для рассылки. Как настроить виджет и всё это можно прочитать в других источниках. Нам же нужно зайти по пути Управление (внизу) -> Настройки (вверху) -> Создать ключ (в самом низу неприметная ссылочка). Созданный ключ и необходимо вставить в эту константу.
- **RASSILKA_ID**: его можно найти уже после создания первого списка рассылки по пути Управление (внизу) -> Рассылки (вверху) -> значок карандашика на конкретной рассылке (появляется при наведении). Самое первое поле будет Id рассылки, его значение мы сюда и копируем. Вот так вот.

После упражнений с вк (да, теперь рассылка в вк уже должна работать) переходим к телеграму. Тут сильно проще.

Нам нужен бот, который будет писать в наш телеграм-канал. Зарегистрировать бота в тг надо через [@BotFather](https://t.me/BotFather). После создания добавляем нашего бота в искомый телеграм-канал с правами админа. Если всё получилось, то [@BotFather](https://t.me/BotFather) вам пришлёт среди прочего такие строки: 
```
Use this token to access the HTTP API:
<сам токен, который никому не говорить>
Keep your token secure and store it safely, it can be used by anyone to control your bot.
```
Вот этот токен мы вставляем в константу **TELEGRAM_KEY**.

А в **TELEGRAM_ID** нужно вставить адрес вашего тг-канала с значком `@`. Да, кстати, ваш канал должен быть публичным, для частных каналов это всё не работает.

Готово! Спасибо за внимание, пишите вопросы в [tg](https://t.me/a_negrash)/[vk](https://vk.com/a_negrash).
